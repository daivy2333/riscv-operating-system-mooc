å¥½çš„ï¼Œæˆ‘ä»¬æ¥ä¸€æ­¥æ­¥å®Œæˆè¿™ä¸¤ä¸ªç»ƒä¹ ã€‚ä½ å·²ç»é…ç½®å¥½äº† `gcc` å’Œ `clang`ï¼Œè¿™éå¸¸å¥½ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨å®ƒä»¬ã€‚

---

## ğŸ“Œ **ç»ƒä¹  3-1ï¼šç¼–è¯‘å¹¶åˆ†æ hello.c**

### âœ… æ­¥éª¤ 1ï¼šç¼–å†™ `hello.c`

åˆ›å»ºä¸€ä¸ªåä¸º `hello.c` çš„æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```c
#include <stdio.h>

int main() {
    printf("hello world!\n");
    return 0;
}
```

> ğŸ’¡ æ³¨æ„ï¼šä¸ºäº†åç»­åæ±‡ç¼–æ—¶èƒ½æ¸…æ™°çœ‹åˆ°æºç ä¸æŒ‡ä»¤çš„å¯¹åº”å…³ç³»ï¼Œå»ºè®®åœ¨ç¼–è¯‘æ—¶åŠ ä¸Š `-g` é€‰é¡¹ä¿ç•™è°ƒè¯•ä¿¡æ¯ã€‚

---

### âœ… æ­¥éª¤ 2ï¼šä½¿ç”¨ gcc ç¼–è¯‘ç”Ÿæˆç›®æ ‡æ–‡ä»¶ `hello.o`

åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œï¼š

```bash
gcc -g -c -m64 hello.c -o hello.o
```

- `-g`ï¼šåŒ…å«è°ƒè¯•ä¿¡æ¯ï¼ˆä¾¿äºåæ±‡ç¼–æ—¶å¯¹ç…§æºç ï¼‰
- `-c`ï¼šåªç¼–è¯‘ä¸é“¾æ¥ï¼Œç”Ÿæˆç›®æ ‡æ–‡ä»¶ `.o`
- `-m64`ï¼šæŒ‡å®šç”Ÿæˆ x86_64 æ¶æ„çš„ç›®æ ‡æ–‡ä»¶ï¼ˆç¬¦åˆé¢˜ç›®è¦æ±‚ï¼‰

---

### âœ… æ­¥éª¤ 3ï¼šæŸ¥çœ‹ `hello.o` çš„æ–‡ä»¶å¤´ä¿¡æ¯

ä½¿ç”¨ `readelf` å·¥å…·ï¼ˆå±äº binutilsï¼‰ï¼š

```bash
readelf -h hello.o
```

ä½ ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„è¾“å‡ºï¼š

```
ELF Header:
  Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00
  Class:                             ELF64
  Data:                              2's complement, little endian
  Version:                           1 (current)
  OS/ABI:                            UNIX - System V
  ABI Version:                       0
  Type:                              REL (Relocatable file)
  Machine:                           Advanced Micro Devices X86-64
  Version:                           0x1
  Entry point address:               0x0
  Start of program headers:          0 (bytes into file)
  Start of section headers:          1080 (bytes into file)
  Flags:                             0x0
  Size of this header:               64 (bytes)
  Size of program headers:           0 (bytes)
  Number of program headers:         0
  Size of section headers:           64 (bytes)
  Number of section headers:         13
  Section header string table index: 12
```

ğŸ“Œ **é‡ç‚¹è§‚å¯Ÿ**ï¼š
- `Class: ELF64` â†’ 64ä½
- `Type: REL` â†’ å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶ï¼ˆä¸æ˜¯å¯æ‰§è¡Œæ–‡ä»¶ï¼‰
- `Machine: Advanced Micro Devices X86-64` â†’ ç›®æ ‡æ¶æ„æ­£ç¡®

---

### âœ… æ­¥éª¤ 4ï¼šæŸ¥çœ‹ `hello.o` çš„ Section Header Table

ç»§ç»­ä½¿ç”¨ `readelf`ï¼š

```bash
readelf -S hello.o
```

ä½ ä¼šçœ‹åˆ°æ‰€æœ‰ section çš„åˆ—è¡¨ï¼Œæ¯”å¦‚ï¼š

```
Section Headers:
  [Nr] Name              Type             Address           Offset
       Size              EntSize          Flags  Link  Info  Align
  [ 0]                   NULL             0000000000000000  00000000
       0000000000000000  0000000000000000           0     0     0
  [ 1] .text             PROGBITS         0000000000000000  00000040
       000000000000001b  0000000000000000  AX       0     0     1
  [ 2] .data             PROGBITS         0000000000000000  0000005b
       0000000000000000  0000000000000000  WA       0     0     1
  [ 3] .bss              NOBITS           0000000000000000  0000005b
       0000000000000000  0000000000000000  WA       0     0     1
  ...
```

ğŸ“Œ **å…³é”® section**ï¼š
- `.text`ï¼šå­˜æ”¾ä»£ç ï¼ˆmain å‡½æ•°ç­‰ï¼‰
- `.data`ï¼šå·²åˆå§‹åŒ–çš„å…¨å±€/é™æ€å˜é‡
- `.bss`ï¼šæœªåˆå§‹åŒ–çš„å…¨å±€/é™æ€å˜é‡
- `.rodata`ï¼šåªè¯»æ•°æ®ï¼ˆå¦‚å­—ç¬¦ä¸²å­—é¢é‡ï¼‰

---

### âœ… æ­¥éª¤ 5ï¼šå¯¹ `hello.o` è¿›è¡Œåæ±‡ç¼–ï¼Œå¹¶å¯¹ç…§æºç 

ä½¿ç”¨ `objdump`ï¼ˆä¹Ÿå±äº binutilsï¼‰ï¼š

```bash
objdump -S hello.o
```

æˆ–æ›´è¯¦ç»†åœ°ï¼š

```bash
objdump -d -S hello.o
```

ä½ ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„è¾“å‡ºï¼š

```
hello.o:     file format elf64-x86-64

Disassembly of section .text:

0000000000000000 <main>:
   0:   55                      push   %rbp
   1:   48 89 e5                mov    %rsp,%rbp
   4:   48 8d 3d 00 00 00 00    lea    0x0(%rip),%rdi        # 11 <main+0x11>
   b:   b8 00 00 00 00          mov    $0x0,%eax
   10:  e8 00 00 00 00          callq  15 <main+0x15>
   15:  b8 00 00 00 00          mov    $0x0,%eax
   1a:  5d                      pop    %rbp
   1b:  c3                      retq

Disassembly of section .rodata:

0000000000000000 <.rodata>:
   0:   68 65 6c 6c 6f 20 77 6f 72 6c 64 21 0a 00    hello world!\n
```

ğŸ“Œ **è§‚å¯Ÿç‚¹**ï¼š
- `main` å‡½æ•°çš„æ±‡ç¼–æŒ‡ä»¤è¢«åˆ—å‡ºã€‚
- å­—ç¬¦ä¸² `"hello world!\n"` å­˜æ”¾åœ¨ `.rodata` æ®µï¼ˆåªè¯»æ•°æ®æ®µï¼‰ï¼Œåœ°å€ä¸º `0x0`ã€‚
- `lea 0x0(%rip),%rdi` è¿™æ¡æŒ‡ä»¤åŠ è½½çš„æ˜¯å­—ç¬¦ä¸²çš„åœ°å€ï¼ˆé€šè¿‡ PC ç›¸å¯¹å¯»å€ï¼‰ã€‚

> ğŸ” ä½ å¯ä»¥ç”¨ `objdump -t hello.o` æŸ¥çœ‹ç¬¦å·è¡¨ï¼Œç¡®è®¤å“ªäº›å˜é‡/å‡½æ•°åœ¨å“ªä¸ª sectionã€‚

---

## ğŸ“Œ **ç»ƒä¹  3-2ï¼šåˆ†æå˜é‡å­˜å‚¨ä½ç½®**

ä½ æä¾›çš„ä»£ç æ˜¯ï¼š

```c
#include <stdio.h>

int global_init = 0x11111111;
const int global_const = 0x22222222;

void main()
{
    static int static_var = 0x33333333;
    static int static_var_uninit;

    int auto_var = 0x44444444;

    printf("hello world!\n");
    return;
}
```

> âš ï¸ æ³¨æ„ï¼š`main()` åº”è¯¥è¿”å› `int`ï¼Œä½†è¿™é‡Œä¸å½±å“åˆ†æã€‚æˆ‘ä»¬å…³æ³¨çš„æ˜¯å˜é‡å­˜å‚¨ä½ç½®ã€‚

---

### âœ… æ­¥éª¤ 1ï¼šç¼–è¯‘æˆ `.o` æ–‡ä»¶

```bash
gcc -g -c -m64 exercise3_2.c -o exercise3_2.o
```

---

### âœ… æ­¥éª¤ 2ï¼šä½¿ç”¨ `readelf` æˆ– `objdump` åˆ†æå„å˜é‡æ‰€åœ¨çš„ section

#### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ `objdump -t` æŸ¥çœ‹ç¬¦å·è¡¨

```bash
objdump -t exercise3_2.o
```

ä½ ä¼šçœ‹åˆ°ç±»ä¼¼ï¼š

```
SYMBOL TABLE:
0000000000000000 l    d  .text	0000000000000000 .text
0000000000000000 l    d  .data	0000000000000000 .data
0000000000000000 l    d  .bss	0000000000000000 .bss
0000000000000000 l    d  .rodata	0000000000000000 .rodata
...
0000000000000000 g     O .data	0000000000000004 global_init
0000000000000000 g     O .rodata	0000000000000004 global_const
0000000000000000 l     O .data	0000000000000004 static_var
0000000000000000 l     O .bss	0000000000000004 static_var_uninit
0000000000000000 l     O .rodata	0000000000000004 .LC0
```

ğŸ“Œ **ç»“è®º**ï¼š

| å˜é‡å              | æ‰€åœ¨ Section | åŸå› è¯´æ˜ |
|---------------------|--------------|----------|
| `global_init`       | `.data`      | å·²åˆå§‹åŒ–çš„å…¨å±€å˜é‡ |
| `global_const`      | `.rodata`    | `const` å…¨å±€å˜é‡ï¼Œå­˜å…¥åªè¯»æ•°æ®æ®µ |
| `static_var`        | `.data`      | å·²åˆå§‹åŒ–çš„é™æ€å±€éƒ¨å˜é‡ï¼ˆä½œç”¨åŸŸé™äºæœ¬æ–‡ä»¶ï¼‰ |
| `static_var_uninit` | `.bss`       | æœªåˆå§‹åŒ–çš„é™æ€å˜é‡ï¼Œè¿è¡Œæ—¶æ¸…é›¶ |
| `auto_var`          | æ ˆä¸Šï¼ˆæ— sectionï¼‰ | å±€éƒ¨è‡ªåŠ¨å˜é‡ï¼Œå­˜å‚¨åœ¨æ ˆå¸§ä¸­ï¼Œä¸åœ¨ä»»ä½• section |

> ğŸ§  è¡¥å……ï¼š`auto_var` æ˜¯å±€éƒ¨å˜é‡ï¼Œç¼–è¯‘åå®ƒä¼šä½œä¸ºæ ˆä¸Šçš„ä¸´æ—¶ç©ºé—´åˆ†é…ï¼Œåœ¨ `.text` ä¸­ä½“ç°ä¸º `mov` æˆ– `sub` æŒ‡ä»¤æ“ä½œæ ˆæŒ‡é’ˆ `%rsp`ï¼Œä¸ä¼šå‡ºç°åœ¨ `.data` æˆ– `.bss` ä¸­ã€‚

---

### âœ… æ­¥éª¤ 3ï¼šéªŒè¯å­—ç¬¦ä¸² `"hello world!\n"` çš„ä½ç½®

å†æ¬¡ä½¿ç”¨ `objdump -s -j .rodata exercise3_2.o`

```bash
objdump -s -j .rodata exercise3_2.o
```

è¾“å‡ºï¼š

```
Contents of section .rodata:
 0000 68656c6c 6f20776f 726c6421 0a00     hello world!\n.
```

âœ… ç¡®è®¤å­—ç¬¦ä¸²å­˜æ”¾åœ¨ `.rodata` æ®µã€‚

---

## âœ… æœ€ç»ˆæ€»ç»“

### ç»ƒä¹  3-1 æ€»ç»“ï¼š

- æˆåŠŸç¼–è¯‘å‡º `hello.o` ç›®æ ‡æ–‡ä»¶ã€‚
- ä½¿ç”¨ `readelf -h` æŸ¥çœ‹äº† ELF æ–‡ä»¶å¤´ã€‚
- ä½¿ç”¨ `readelf -S` æŸ¥çœ‹äº† section header tableã€‚
- ä½¿ç”¨ `objdump -S` åæ±‡ç¼–å¹¶çœ‹åˆ°äº†æºç ä¸æœºå™¨æŒ‡ä»¤çš„å¯¹åº”å…³ç³»ã€‚
- å­—ç¬¦ä¸²å¸¸é‡å­˜æ”¾åœ¨ `.rodata`ã€‚

### ç»ƒä¹  3-2 æ€»ç»“ï¼š

| å˜é‡å              | å­˜å‚¨ä½ç½®        | è¯´æ˜ |
|---------------------|-----------------|------|
| `global_init`       | `.data`         | å·²åˆå§‹åŒ–å…¨å±€å˜é‡ |
| `global_const`      | `.rodata`       | `const` å…¨å±€å˜é‡ |
| `static_var`        | `.data`         | å·²åˆå§‹åŒ–é™æ€å˜é‡ |
| `static_var_uninit` | `.bss`          | æœªåˆå§‹åŒ–é™æ€å˜é‡ |
| `auto_var`          | æ ˆï¼ˆ`.text`ç›¸å…³ï¼‰ | å±€éƒ¨è‡ªåŠ¨å˜é‡ï¼Œæ— ç‹¬ç«‹ section |
| `"hello world!\n"`  | `.rodata`       | å­—ç¬¦ä¸²å­—é¢é‡ |

---

## ğŸ’¡ å°è´´å£«

- å¦‚æœä½ æƒ³çœ‹åˆ°æ›´è¯¦ç»†çš„å†…å­˜å¸ƒå±€ï¼Œå¯ä»¥ä½¿ç”¨ `nm`ã€`readelf -l`ï¼ˆç¨‹åºå¤´ï¼‰ã€`objdump -h`ï¼ˆsection headerï¼‰ç­‰å·¥å…·ã€‚
- å¯¹æ¯” `clang` ç¼–è¯‘çš„ç»“æœï¼š`clang -g -c -m64 hello.c -o hello_clang.o`ï¼Œç„¶åç”¨ç›¸åŒå‘½ä»¤åˆ†æï¼Œä½ ä¼šå‘ç°ç»“æ„åŸºæœ¬ä¸€è‡´ï¼Œåªæ˜¯æŸäº›ä¼˜åŒ–æˆ–è°ƒè¯•ä¿¡æ¯ç•¥æœ‰ä¸åŒã€‚

---

âœ… ä½ ç°åœ¨å·²ç»æŒæ¡äº†å¦‚ä½•ä½¿ç”¨ GCC + Binutils å·¥å…·é“¾åˆ†æ ELF æ–‡ä»¶ç»“æ„å’Œå˜é‡å­˜å‚¨ä½ç½®ï¼è¿™æ˜¯ç†è§£ç¨‹åºåº•å±‚æœºåˆ¶çš„é‡è¦ä¸€æ­¥ï¼

å¦‚æœä½ éœ€è¦æˆ‘å¸®ä½ å†™ä¸€ä¸ªè‡ªåŠ¨åŒ–è„šæœ¬æˆ–è€…å¯è§†åŒ–è¡¨æ ¼ï¼Œä¹Ÿå¯ä»¥å‘Šè¯‰æˆ‘ ğŸ˜Š